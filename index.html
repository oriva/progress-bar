<!doctype html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		  content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Тестовое</title>
	<link rel="stylesheet" href="css/index.css">
</head>
<body>
<!--Стили задаются в переменную-->
<div class="scroll-progress">
	<div class="scroll-progress__val"></div>
	<div class="scroll-progress__dots-block">

	</div>
</div>
<div class="anchor" id="block-1">
	<h2>Lorem ipsum dolor sit amet</h2>
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.</p>
</div>
<div class="anchor" id="block-2">
	<h2>Lorem ipsum dolor sit amet</h2>
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.</p>
</div>
<div class="anchor" id="block-3">
	<h2>Lorem ipsum dolor sit amet</h2>
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.</p>
</div>
<div class="anchor" id="block-4">
	<h2>Lorem ipsum dolor sit amet</h2>
	<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.
	   Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aliquam corporis deserunt distinctio
	   dolorem impedit inventore itaque iusto molestiae necessitatibus odio officiis quam quisquam repellendus
	   reprehenderit suscipit tenetur vel voluptas.</p>
</div>


<script>
    window.addEventListener('load', function () {
        // Функция debounce не моя, взял готовую
        function debounce(func, wait, immediate) {
            let timeout;
            return function () {
                const context = this, args = arguments;
                let later = function () {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                let callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        }

        // функция для получения значения позиции в процентах на основе переданной позиции в getPerc
		const getPercentNow = (() => {
            const onePercent = (Math.max(
                document.body.scrollHeight, document.documentElement.scrollHeight,
                document.body.offsetHeight, document.documentElement.offsetHeight,
                document.body.clientHeight, document.documentElement.clientHeight
            )-innerHeight)/100;

            function getPercent(now) {
                let percent = now/onePercent;
                if(percent>100)
                    percent = 100;
                return percent;
            }

            return {
                getPerc: (now) => {
                    return Math.round(getPercent(now))
				}
			}
		})();

        // функция для прогресс бара
        const watchScroll = debounce(function () {
            document.querySelector('.scroll-progress__val').style = 'width: ' + getPercentNow.getPerc(window.pageYOffset) + '%';
        }, 3);
        window.addEventListener('scroll', watchScroll);

        // первый вызов прогрессбара при старте, для получения текущего положения страницы.
        watchScroll();

        const createDomAnchor = (targetElem) => {
            let elem = document.createElement('div');
            let elemPercent = getPercentNow.getPerc(targetElem.offsetTop);
            elem.style = 'left: ' + elemPercent + '%';
            elem.dataset.anchorPosition = targetElem.offsetTop;
            return elem;
		};
		// у элемента обязательно должен присутствовать класс anchor
        const getAllAnchor = () => {
            const elemDotsContainer = document.querySelector('.scroll-progress__dots-block');
            elemDotsContainer.innerHTML = '';
            document.querySelectorAll('.anchor').forEach((item)=>{
                elemDotsContainer.appendChild(createDomAnchor(item));
			});
		};
        getAllAnchor();

        document.querySelector('.scroll-progress__dots-block').addEventListener('click', (e)=>{
            if(e.target.dataset.anchorPosition) {
				window.scroll({
					top: e.target.dataset.anchorPosition,
					behavior: 'smooth'
				});
			}
		});
    });
</script>
</body>
</html>